<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tower Defense: Royal Defender</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* –ë–∞–∑–æ–≤—ã–µ —Å—Ç–∏–ª–∏ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Cinzel', 'Georgia', serif;
        }
        
        body {
            min-height: 100vh;
            background: 
                radial-gradient(circle at 10% 20%, rgba(120, 60, 20, 0.25) 0%, transparent 40%),
                radial-gradient(circle at 90% 30%, rgba(160, 40, 40, 0.25) 0%, transparent 40%),
                radial-gradient(circle at 50% 80%, rgba(200, 150, 30, 0.25) 0%, transparent 40%),
                linear-gradient(135deg, #0c0c1a 0%, #1a1a2e 100%);
            color: #f0e6d2;
            overflow-x: hidden;
            position: relative;
        }
        
        /* –ê–Ω–∏–º–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ñ–æ–Ω —Å —á–∞—Å—Ç–∏—Ü–∞–º–∏ */
        .particles {
            position: fixed;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 0;
        }
        
        /* –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∏–≥—Ä—ã */
        .game-container {
            position: relative;
            max-width: 1600px;
            margin: 0 auto;
            padding: 20px;
            z-index: 2;
        }
        
        /* –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å –∞–Ω–∏–º–∞—Ü–∏–µ–π */
        .game-header {
            text-align: center;
            margin-bottom: 30px;
            padding: 25px;
            background: linear-gradient(90deg, 
                rgba(139, 69, 19, 0.3) 0%, 
                rgba(178, 34, 34, 0.4) 50%, 
                rgba(184, 134, 11, 0.3) 100%);
            border-radius: 20px;
            border: 2px solid rgba(255, 215, 0, 0.3);
            box-shadow: 
                0 10px 30px rgba(0, 0, 0, 0.5),
                inset 0 0 50px rgba(255, 215, 0, 0.1);
            position: relative;
            overflow: hidden;
        }
        
        .game-header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, 
                transparent 30%, 
                rgba(255, 215, 0, 0.1) 50%, 
                transparent 70%);
            animation: shine 8s infinite linear;
        }
        
        @keyframes shine {
            0% { transform: translateX(-100%) translateY(-100%) rotate(0deg); }
            100% { transform: translateX(100%) translateY(100%) rotate(360deg); }
        }
        
        .game-title {
            font-size: 3.5rem;
            background: linear-gradient(to right, #f0e6d2, #ffd700, #daa520);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            text-shadow: 0 0 30px rgba(218, 165, 32, 0.5);
            margin-bottom: 10px;
            letter-spacing: 3px;
            position: relative;
            z-index: 1;
        }
        
        .game-subtitle {
            font-size: 1.3rem;
            color: #c9b37e;
            font-style: italic;
            position: relative;
            z-index: 1;
        }
        
        /* –û—Å–Ω–æ–≤–Ω–æ–π –∏–≥—Ä–æ–≤–æ–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å */
        .game-interface {
            display: grid;
            grid-template-columns: 280px 1fr 280px;
            gap: 25px;
            margin-bottom: 30px;
        }
        
        /* –ë–æ–∫–æ–≤—ã–µ –ø–∞–Ω–µ–ª–∏ —Å —É–ª—É—á—à–µ–Ω–Ω–æ–π –∞–Ω–∏–º–∞—Ü–∏–µ–π */
        .side-panel {
            background: linear-gradient(145deg, 
                rgba(30, 30, 40, 0.9) 0%, 
                rgba(50, 50, 70, 0.85) 100%);
            border-radius: 20px;
            padding: 25px;
            border: 2px solid;
            position: relative;
            overflow: hidden;
            box-shadow: 
                0 10px 25px rgba(0, 0, 0, 0.4),
                inset 0 0 30px rgba(255, 215, 0, 0.1);
            backdrop-filter: blur(10px);
        }
        
        .left-panel {
            border-color: #8b4513;
            border-image: linear-gradient(45deg, #8b4513, #daa520) 1;
        }
        
        .right-panel {
            border-color: #b22222;
            border-image: linear-gradient(45deg, #b22222, #ff8c00) 1;
        }
        
        .panel-title {
            font-size: 1.8rem;
            color: #ffd700;
            margin-bottom: 25px;
            padding-bottom: 12px;
            border-bottom: 2px solid rgba(218, 165, 32, 0.5);
            text-align: center;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }
        
        /* –ö–∞—Ä—Ç–æ—á–∫–∏ –±–∞—à–µ–Ω */
        .tower-card {
            background: linear-gradient(145deg, 
                rgba(40, 40, 60, 0.8) 0%, 
                rgba(60, 60, 80, 0.9) 100%);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border: 2px solid transparent;
            position: relative;
            overflow: hidden;
        }
        
        .tower-card:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
            border-color: #ffd700;
        }
        
        .tower-card.active {
            background: linear-gradient(145deg, 
                rgba(139, 69, 19, 0.6) 0%, 
                rgba(178, 34, 34, 0.7) 100%);
            border-color: #ffd700;
            box-shadow: 0 0 30px rgba(255, 215, 0, 0.3);
        }
        
        .tower-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, 
                transparent, 
                rgba(255, 255, 255, 0.1), 
                transparent);
            transition: left 0.5s;
        }
        
        .tower-card:hover::before {
            left: 100%;
        }
        
        .tower-name {
            font-size: 1.4rem;
            color: #ffd700;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .tower-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin: 15px 0;
        }
        
        .stat {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 8px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
        }
        
        .stat-value {
            font-size: 1.2rem;
            font-weight: bold;
            color: #fff;
        }
        
        .stat-label {
            font-size: 0.9rem;
            color: #c9b37e;
        }
        
        /* –ö–Ω–æ–ø–∫–∏ —Å –∞–Ω–∏–º–∞—Ü–∏–µ–π */
        .game-button {
            width: 100%;
            padding: 16px;
            margin: 12px 0;
            border: none;
            border-radius: 12px;
            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            position: relative;
            overflow: hidden;
        }
        
        .game-button::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 5px;
            height: 5px;
            background: rgba(255, 255, 255, 0.5);
            opacity: 0;
            border-radius: 100%;
            transform: scale(1, 1) translate(-50%);
            transform-origin: 50% 50%;
        }
        
        .game-button:active::after {
            animation: ripple 1s ease-out;
        }
        
        @keyframes ripple {
            0% {
                transform: scale(0, 0);
                opacity: 0.5;
            }
            100% {
                transform: scale(50, 50);
                opacity: 0;
            }
        }
        
        .btn-primary {
            background: linear-gradient(to bottom, #32CD32, #228B22);
            color: white;
            box-shadow: 0 5px 15px rgba(50, 205, 50, 0.3);
        }
        
        .btn-primary:hover {
            background: linear-gradient(to bottom, #3cb371, #2E8B57);
            box-shadow: 0 8px 20px rgba(50, 205, 50, 0.5);
            transform: translateY(-2px);
        }
        
        .btn-warning {
            background: linear-gradient(to bottom, #FFA500, #FF8C00);
            color: white;
            box-shadow: 0 5px 15px rgba(255, 165, 0, 0.3);
        }
        
        .btn-warning:hover {
            background: linear-gradient(to bottom, #FFB347, #FF8C00);
            box-shadow: 0 8px 20px rgba(255, 165, 0, 0.5);
            transform: translateY(-2px);
        }
        
        .btn-info {
            background: linear-gradient(to bottom, #1E90FF, #4169E1);
            color: white;
            box-shadow: 0 5px 15px rgba(30, 144, 255, 0.3);
        }
        
        .btn-info:hover {
            background: linear-gradient(to bottom, #63B3ED, #4169E1);
            box-shadow: 0 8px 20px rgba(30, 144, 255, 0.5);
            transform: translateY(-2px);
        }
        
        /* –ò–≥—Ä–æ–≤–æ–µ –ø–æ–ª–µ */
        .game-field {
            background: 
                url('https://png.pngtree.com/png-clipart/20240613/original/pngtree-lion-head-face-logo-silhouette-black-icon-tattoo-mascot-hand-drawn-png-image_15317165.png') center/contain no-repeat,
                radial-gradient(circle at center, 
                    rgba(20, 25, 45, 0.95) 0%, 
                    rgba(10, 15, 30, 0.98) 100%);
            border-radius: 20px;
            padding: 20px;
            box-shadow: 
                inset 0 0 50px rgba(0, 0, 0, 0.7),
                0 0 40px rgba(139, 69, 19, 0.4);
            border: 3px solid #8b4513;
            position: relative;
            min-height: 600px;
            display: flex;
            flex-direction: column;
        }
        
        .canvas-container {
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
        }
        
        #gameCanvas {
            border-radius: 15px;
            box-shadow: 
                0 0 30px rgba(255, 215, 0, 0.3),
                inset 0 0 30px rgba(0, 0, 0, 0.6);
            border: 2px solid rgba(218, 165, 32, 0.6);
            background-color: rgba(15, 20, 35, 0.9);
        }
        
        /* –ü–∞–Ω–µ–ª—å —Å–æ–æ–±—â–µ–Ω–∏–π —Å –∞–Ω–∏–º–∞—Ü–∏–µ–π */
        .message-panel {
            background: linear-gradient(to right, 
                rgba(139, 69, 19, 0.8), 
                rgba(178, 34, 34, 0.8));
            border-radius: 15px;
            padding: 20px;
            margin-top: 20px;
            text-align: center;
            border: 2px solid rgba(255, 215, 0, 0.5);
            position: relative;
            overflow: hidden;
            min-height: 70px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        #gameMessage {
            font-size: 1.3rem;
            font-weight: bold;
            color: #ffd700;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.7);
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 0.8; }
            50% { opacity: 1; }
            100% { opacity: 0.8; }
        }
        
        /* –ü—Ä–æ–≥—Ä–µ—Å—Å –±–∞—Ä –≤–æ–ª–Ω—ã */
        .wave-progress {
            height: 8px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 4px;
            margin: 15px 0;
            overflow: hidden;
            position: relative;
        }
        
        .wave-progress-bar {
            height: 100%;
            background: linear-gradient(to right, #32CD32, #FFD700);
            width: 0%;
            transition: width 0.5s ease;
            border-radius: 4px;
            position: relative;
            overflow: hidden;
        }
        
        .wave-progress-bar::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, 
                transparent 0%, 
                rgba(255, 255, 255, 0.2) 50%, 
                transparent 100%);
            animation: shimmer 2s infinite;
        }
        
        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }
        
        /* –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(5px);
        }
        
        .modal-content {
            background: linear-gradient(145deg, 
                rgba(30, 30, 50, 0.95) 0%, 
                rgba(50, 50, 70, 0.95) 100%);
            border-radius: 25px;
            padding: 40px;
            max-width: 600px;
            width: 90%;
            border: 3px solid #daa520;
            box-shadow: 0 0 50px rgba(218, 165, 32, 0.5);
            position: relative;
            animation: modalAppear 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        @keyframes modalAppear {
            from {
                opacity: 0;
                transform: scale(0.8) translateY(-50px);
            }
            to {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }
        
        .close-modal {
            position: absolute;
            top: 20px;
            right: 20px;
            font-size: 2rem;
            color: #ffd700;
            cursor: pointer;
            transition: transform 0.3s;
        }
        
        .close-modal:hover {
            transform: rotate(90deg);
        }
        
        /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
        @media (max-width: 1200px) {
            .game-interface {
                grid-template-columns: 1fr;
                grid-template-rows: auto auto auto;
            }
            
            .left-panel, .right-panel {
                order: 2;
            }
            
            .game-field {
                order: 1;
                min-height: 500px;
            }
            
            .game-title {
                font-size: 2.5rem;
            }
        }
        
        @media (max-width: 768px) {
            .game-container {
                padding: 10px;
            }
            
            .game-title {
                font-size: 2rem;
            }
            
            .tower-stats {
                grid-template-columns: 1fr;
            }
        }
        
        /* –≠—Ñ—Ñ–µ–∫—Ç –ø–∞—Ä–∞–ª–ª–∞–∫—Å–∞ –¥–ª—è –≥–ª—É–±–∏–Ω—ã */
        .parallax-layer {
            position: absolute;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }
        
        .layer-1 { animation: parallax1 20s infinite linear; }
        .layer-2 { animation: parallax2 15s infinite linear; }
        .layer-3 { animation: parallax3 25s infinite linear; }
        
        @keyframes parallax1 {
            0% { transform: translateY(0px); }
            100% { transform: translateY(-1000px); }
        }
        
        @keyframes parallax2 {
            0% { transform: translateX(0px) translateY(0px); }
            100% { transform: translateX(-500px) translateY(-500px); }
        }
        
        @keyframes parallax3 {
            0% { transform: translateY(0px) rotate(0deg); }
            100% { transform: translateY(-800px) rotate(180deg); }
        }
    </style>
</head>
<body>
    <!-- –ê–Ω–∏–º–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —á–∞—Å—Ç–∏—Ü—ã –Ω–∞ —Ñ–æ–Ω–µ -->
    <div class="particles" id="particles"></div>
    
    <!-- –ü–∞—Ä–∞–ª–ª–∞–∫—Å —Å–ª–æ–∏ -->
    <div class="parallax-layer layer-1"></div>
    <div class="parallax-layer layer-2"></div>
    <div class="parallax-layer layer-3"></div>
    
    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–æ–º–æ—â–∏ -->
    <div id="helpModal" class="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModal('helpModal')">&times;</span>
            <h2 style="color: #ffd700; margin-bottom: 20px; text-align: center;">–ü–æ–º–æ—â—å –ø–æ –∏–≥—Ä–µ</h2>
            <div style="line-height: 1.8;">
                <p><strong>üéØ –¶–µ–ª—å –∏–≥—Ä—ã:</strong> –ó–∞—â–∏—Ç–∏—Ç–µ –∑–∞–º–æ–∫ –æ—Ç –≤—Ä–∞–≥–æ–≤, –ø–æ—Å—Ç—Ä–æ–∏–≤ –∏ —É–ª—É—á—à–∞—è –±–∞—à–Ω–∏.</p>
                <p><strong>üèóÔ∏è –ü–æ—Å—Ç—Ä–æ–π–∫–∞ –±–∞—à–µ–Ω:</strong> –í—ã–±–µ—Ä–∏—Ç–µ –±–∞—à–Ω—é —Å–ª–µ–≤–∞ –∏ –∫–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ –∏–≥—Ä–æ–≤–æ–µ –ø–æ–ª–µ.</p>
                <p><strong>‚ö° –£–ª—É—á—à–µ–Ω–∏–µ –±–∞—à–µ–Ω:</strong> –ö–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é –±–∞—à–Ω—é –∏ –Ω–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É —É–ª—É—á—à–µ–Ω–∏—è.</p>
                <p><strong>üí∞ –ó–æ–ª–æ—Ç–æ:</strong> –ü–æ–ª—É—á–∞–π—Ç–µ –∑–∞ —É–±–∏–π—Å—Ç–≤–æ –≤—Ä–∞–≥–æ–≤, —Ç—Ä–∞—Ç—å—Ç–µ –Ω–∞ –ø–æ—Å—Ç—Ä–æ–π–∫—É –∏ —É–ª—É—á—à–µ–Ω–∏—è.</p>
                <p><strong>‚ù§Ô∏è –ñ–∏–∑–Ω–∏:</strong> –¢–µ—Ä—è—é—Ç—Å—è –∫–æ–≥–¥–∞ –≤—Ä–∞–≥–∏ –¥–æ—Ö–æ–¥—è—Ç –¥–æ –∑–∞–º–∫–∞. –ò–≥—Ä–∞ –∑–∞–∫–∞–Ω—á–∏–≤–∞–µ—Ç—Å—è –ø—Ä–∏ 0 –∂–∏–∑–Ω—è—Ö.</p>
                <p><strong>üåä –í–æ–ª–Ω—ã:</strong> –ö–∞–∂–¥–∞—è —Å–ª–µ–¥—É—é—â–∞—è –≤–æ–ª–Ω–∞ —Å–ª–æ–∂–Ω–µ–µ –ø—Ä–µ–¥—ã–¥—É—â–µ–π. –í—Å–µ–≥–æ 15 –≤–æ–ª–Ω.</p>
                <p><strong>üèÜ –ü–æ–±–µ–¥–∞:</strong> –ü—Ä–æ–π–¥–∏—Ç–µ –≤—Å–µ 15 –≤–æ–ª–Ω —á—Ç–æ–±—ã –ø–æ–±–µ–¥–∏—Ç—å!</p>
            </div>
        </div>
    </div>
    
    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Ä–µ–∫–æ—Ä–¥–æ–≤ -->
    <div id="recordsModal" class="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModal('recordsModal')">&times;</span>
            <h2 style="color: #ffd700; margin-bottom: 20px; text-align: center;">–†–µ–∫–æ—Ä–¥—ã</h2>
            <div id="recordsList" style="margin-top: 20px;">
                <!-- –†–µ–∫–æ—Ä–¥—ã –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
            </div>
        </div>
    </div>
    
    <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∏–≥—Ä—ã -->
    <div class="game-container">
        <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ -->
        <header class="game-header">
            <h1 class="game-title">TOWER DEFENSE: ROYAL DEFENDER</h1>
            <p class="game-subtitle">–ó–∞—â–∏—Ç–∏ –∫–æ—Ä–æ–ª–µ–≤—Å—Ç–≤–æ –ª—å–≤–∞ –æ—Ç –ø–æ–ª—á–∏—â –≤—Ä–∞–≥–æ–≤!</p>
        </header>
        
        <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∏–≥—Ä–æ–≤–æ–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å -->
        <div class="game-interface">
            <!-- –õ–µ–≤–∞—è –ø–∞–Ω–µ–ª—å - –ë–∞—à–Ω–∏ -->
            <div class="side-panel left-panel">
                <h2 class="panel-title">
                    <i class="fas fa-tower-observation"></i> –ë–ê–®–ù–ò
                </h2>
                
                <div class="tower-cards">
                    <div class="tower-card active" data-tower="basic" data-cost="60">
                        <div class="tower-name">
                            <i class="fas fa-bow-arrow"></i> –°—Ç—Ä–µ–ª–∫–æ–≤–∞—è
                        </div>
                        <div class="tower-stats">
                            <div class="stat">
                                <span class="stat-value" style="color: #ff4444;">15</span>
                                <span class="stat-label">–£—Ä–æ–Ω</span>
                            </div>
                            <div class="stat">
                                <span class="stat-value" style="color: #44ff44;">140px</span>
                                <span class="stat-label">–î–∞–ª—å–Ω–æ—Å—Ç—å</span>
                            </div>
                            <div class="stat">
                                <span class="stat-value" style="color: #4444ff;">1.0s</span>
                                <span class="stat-label">–°–∫–æ—Ä–æ—Å—Ç—å</span>
                            </div>
                            <div class="stat">
                                <span class="stat-value" style="color: #ffaa00;">60</span>
                                <span class="stat-label">–°—Ç–æ–∏–º–æ—Å—Ç—å</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="tower-card" data-tower="sniper" data-cost="140">
                        <div class="tower-name">
                            <i class="fas fa-crosshairs"></i> –°–Ω–∞–π–ø–µ—Ä—Å–∫–∞—è
                        </div>
                        <div class="tower-stats">
                            <div class="stat">
                                <span class="stat-value" style="color: #ff4444;">35</span>
                                <span class="stat-label">–£—Ä–æ–Ω</span>
                            </div>
                            <div class="stat">
                                <span class="stat-value" style="color: #44ff44;">220px</span>
                                <span class="stat-label">–î–∞–ª—å–Ω–æ—Å—Ç—å</span>
                            </div>
                            <div class="stat">
                                <span class="stat-value" style="color: #4444ff;">2.0s</span>
                                <span class="stat-label">–°–∫–æ—Ä–æ—Å—Ç—å</span>
                            </div>
                            <div class="stat">
                                <span class="stat-value" style="color: #ffaa00;">140</span>
                                <span class="stat-label">–°—Ç–æ–∏–º–æ—Å—Ç—å</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="tower-card" data-tower="cannon" data-cost="220">
                        <div class="tower-name">
                            <i class="fas fa-explosion"></i> –ü—É—à–∫–∞
                        </div>
                        <div class="tower-stats">
                            <div class="stat">
                                <span class="stat-value" style="color: #ff4444;">50</span>
                                <span class="stat-label">–£—Ä–æ–Ω</span>
                            </div>
                            <div class="stat">
                                <span class="stat-value" style="color: #44ff44;">110px</span>
                                <span class="stat-label">–î–∞–ª—å–Ω–æ—Å—Ç—å</span>
                            </div>
                            <div class="stat">
                                <span class="stat-value" style="color: #4444ff;">2.5s</span>
                                <span class="stat-label">–°–∫–æ—Ä–æ—Å—Ç—å</span>
                            </div>
                            <div class="stat">
                                <span class="stat-value" style="color: #ffaa00;">220</span>
                                <span class="stat-label">–°—Ç–æ–∏–º–æ—Å—Ç—å</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="tower-card" data-tower="magic" data-cost="320">
                        <div class="tower-name">
                            <i class="fas fa-hat-wizard"></i> –ú–∞–≥–∏—á–µ—Å–∫–∞—è
                        </div>
                        <div class="tower-stats">
                            <div class="stat">
                                <span class="stat-value" style="color: #ff4444;">20</span>
                                <span class="stat-label">–£—Ä–æ–Ω</span>
                            </div>
                            <div class="stat">
                                <span class="stat-value" style="color: #44ff44;">160px</span>
                                <span class="stat-label">–î–∞–ª—å–Ω–æ—Å—Ç—å</span>
                            </div>
                            <div class="stat">
                                <span class="stat-value" style="color: #4444ff;">0.5s</span>
                                <span class="stat-label">–°–∫–æ—Ä–æ—Å—Ç—å</span>
                            </div>
                            <div class="stat">
                                <span class="stat-value" style="color: #ffaa00;">320</span>
                                <span class="stat-label">–°—Ç–æ–∏–º–æ—Å—Ç—å</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="selected-tower-info">
                    <h3 style="color: #ffd700; margin: 20px 0 15px; text-align: center;">
                        <i class="fas fa-info-circle"></i> –ò–ù–§–û–†–ú–ê–¶–ò–Ø
                    </h3>
                    <div style="background: rgba(0,0,0,0.3); padding: 15px; border-radius: 10px;">
                        <p style="margin-bottom: 10px;"><strong>–í—ã–±—Ä–∞–Ω–∞:</strong> <span id="selectedTowerName">–°—Ç—Ä–µ–ª–∫–æ–≤–∞—è</span></p>
                        <p style="margin-bottom: 10px;"><strong>–£—Ä–æ–≤–µ–Ω—å:</strong> <span id="towerLevel">1</span></p>
                        <p style="margin-bottom: 10px;"><strong>–°—Ç–æ–∏–º–æ—Å—Ç—å —É–ª—É—á—à–µ–Ω–∏—è:</strong> <span id="upgradeCost">120</span> –∑–æ–ª–æ—Ç–∞</p>
                    </div>
                </div>
            </div>
            
            <!-- –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è –æ–±–ª–∞—Å—Ç—å - –ò–≥—Ä–æ–≤–æ–µ –ø–æ–ª–µ -->
            <div class="game-field">
                <div class="canvas-container">
                    <canvas id="gameCanvas" width="800" height="550"></canvas>
                </div>
                
                <!-- –ü—Ä–æ–≥—Ä–µ—Å—Å –≤–æ–ª–Ω—ã -->
                <div style="margin-top: 20px;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                        <span>–ü—Ä–æ–≥—Ä–µ—Å—Å –≤–æ–ª–Ω—ã:</span>
                        <span id="waveProgressText">0/0</span>
                    </div>
                    <div class="wave-progress">
                        <div class="wave-progress-bar" id="waveProgressBar"></div>
                    </div>
                </div>
                
                <!-- –ü–∞–Ω–µ–ª—å —Å–æ–æ–±—â–µ–Ω–∏–π -->
                <div class="message-panel">
                    <div id="gameMessage">–í—ã–±–µ—Ä–∏—Ç–µ –±–∞—à–Ω—é –∏ –Ω–∞—á–Ω–∏—Ç–µ –∏–≥—Ä—É!</div>
                </div>
            </div>
            
            <!-- –ü—Ä–∞–≤–∞—è –ø–∞–Ω–µ–ª—å - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ -->
            <div class="side-panel right-panel">
                <h2 class="panel-title">
                    <i class="fas fa-chart-line"></i> –°–¢–ê–¢–ò–°–¢–ò–ö–ê
                </h2>
                
                <div class="game-stats">
                    <div style="background: rgba(0,0,0,0.3); padding: 20px; border-radius: 15px; margin-bottom: 25px;">
                        <div class="stat-display">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 15px;">
                                <span><i class="fas fa-coins" style="color: #ffd700;"></i> –ó–æ–ª–æ—Ç–æ:</span>
                                <span id="goldAmount" style="font-weight: bold; color: #ffd700;">200</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin-bottom: 15px;">
                                <span><i class="fas fa-heart" style="color: #ff4444;"></i> –ñ–∏–∑–Ω–∏:</span>
                                <span id="livesCount" style="font-weight: bold; color: #ff4444;">25</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin-bottom: 15px;">
                                <span><i class="fas fa-wave-square" style="color: #44ff44;"></i> –í–æ–ª–Ω–∞:</span>
                                <span id="waveNumber" style="font-weight: bold; color: #44ff44;">1/15</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin-bottom: 15px;">
                                <span><i class="fas fa-skull-crossbones" style="color: #ffaa00;"></i> –£–±–∏—Ç–æ:</span>
                                <span id="enemiesKilled" style="font-weight: bold; color: #ffaa00;">0</span>
                            </div>
                            <div style="display: flex; justify-content: space-between;">
                                <span><i class="fas fa-star" style="color: #aa44ff;"></i> –°—á—ë—Ç:</span>
                                <span id="scoreValue" style="font-weight: bold; color: #aa44ff;">0</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <h2 class="panel-title">
                    <i class="fas fa-gamepad"></i> –£–ü–†–ê–í–õ–ï–ù–ò–ï
                </h2>
                
                <div class="game-controls">
                    <button class="game-button btn-primary" id="startWaveBtn">
                        <i class="fas fa-play"></i> –ù–ê–ß–ê–¢–¨ –í–û–õ–ù–£
                    </button>
                    
                    <button class="game-button btn-warning" id="upgradeTowerBtn">
                        <i class="fas fa-arrow-up"></i> –£–õ–£–ß–®–ò–¢–¨ –ë–ê–®–ù–Æ
                    </button>
                    
                    <button class="game-button btn-info" id="pauseGameBtn">
                        <i class="fas fa-pause"></i> –ü–ê–£–ó–ê
                    </button>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 15px;">
                        <button class="game-button" onclick="showModal('helpModal')" 
                                style="background: #6a11cb; color: white; font-size: 1rem;">
                            <i class="fas fa-question-circle"></i> –ü–æ–º–æ—â—å
                        </button>
                        
                        <button class="game-button" onclick="showModal('recordsModal')"
                                style="background: #2575fc; color: white; font-size: 1rem;">
                            <i class="fas fa-trophy"></i> –†–µ–∫–æ—Ä–¥—ã
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ==================== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –ò–ì–†–´ ====================
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        
        // –ò–≥—Ä–æ–≤—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let gameState = {
            gold: 200,
            lives: 25,
            score: 0,
            wave: 1,
            totalWaves: 15,
            enemiesKilled: 0,
            enemiesInWave: 6,
            enemiesAlive: 0,
            gameRunning: false,
            gamePaused: false,
            selectedTower: 'basic',
            selectedTowerCost: 60,
            towerLevel: 1,
            upgradeCost: 120,
            selectedTowerForUpgrade: null,
            waveStartTime: 0,
            waveDuration: 60000 // 60 —Å–µ–∫—É–Ω–¥ –Ω–∞ –≤–æ–ª–Ω—É
        };
        
        // –ò–≥—Ä–æ–≤—ã–µ –æ–±—ä–µ–∫—Ç—ã
        const towers = [];
        const enemies = [];
        const projectiles = [];
        const particles = [];
        const effects = [];
        
        // –ü—É—Ç—å –≤—Ä–∞–≥–æ–≤ —Å –∏–∑–≤–∏–ª–∏—Å—Ç–æ–π —Ç—Ä–∞–µ–∫—Ç–æ—Ä–∏–µ–π
        const enemyPath = [
            {x: -20, y: 150},
            {x: 120, y: 150},
            {x: 120, y: 80},
            {x: 250, y: 80},
            {x: 250, y: 200},
            {x: 400, y: 200},
            {x: 400, y: 100},
            {x: 550, y: 100},
            {x: 550, y: 250},
            {x: 700, y: 250},
            {x: 700, y: 150},
            {x: 820, y: 150}
        ];
        
        // ==================== –°–ò–°–¢–ï–ú–ê –ß–ê–°–¢–ò–¶ ====================
        class Particle {
            constructor(x, y, color, velocity, size = 2, life = 60) {
                this.x = x;
                this.y = y;
                this.color = color;
                this.velocity = velocity;
                this.size = size;
                this.life = life;
                this.maxLife = life;
                this.gravity = 0.1;
                this.alpha = 1;
            }
            
            update() {
                this.x += this.velocity.x;
                this.y += this.velocity.y;
                this.velocity.y += this.gravity;
                this.life--;
                this.alpha = this.life / this.maxLife;
                return this.life > 0;
            }
            
            draw() {
                ctx.save();
                ctx.globalAlpha = this.alpha;
                ctx.fillStyle = this.color;
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                ctx.fill();
                ctx.restore();
            }
        }
        
        // –°–æ–∑–¥–∞–Ω–∏–µ —á–∞—Å—Ç–∏—Ü –¥–ª—è —Ñ–æ–Ω–∞
        function createBackgroundParticles() {
            const particlesContainer = document.getElementById('particles');
            for (let i = 0; i < 50; i++) {
                const particle = document.createElement('div');
                particle.style.position = 'absolute';
                particle.style.width = Math.random() * 3 + 1 + 'px';
                particle.style.height = particle.style.width;
                particle.style.backgroundColor = `rgba(${Math.random() * 55 + 200}, ${Math.random() * 55 + 165}, ${Math.random() * 55 + 32}, ${Math.random() * 0.3 + 0.1})`;
                particle.style.borderRadius = '50%';
                particle.style.left = Math.random() * 100 + 'vw';
                particle.style.top = Math.random() * 100 + 'vh';
                particle.style.boxShadow = '0 0 10px rgba(255, 215, 0, 0.5)';
                particlesContainer.appendChild(particle);
                
                // –ê–Ω–∏–º–∞—Ü–∏—è –¥–≤–∏–∂–µ–Ω–∏—è —á–∞—Å—Ç–∏—Ü
                particle.animate([
                    { transform: 'translateY(0px)', opacity: 0 },
                    { transform: `translateY(${Math.random() * -100 - 50}px)`, opacity: 0.8 },
                    { transform: `translateY(${Math.random() * -200 - 100}px)`, opacity: 0 }
                ], {
                    duration: Math.random() * 3000 + 2000,
                    delay: Math.random() * 2000,
                    iterations: Infinity
                });
            }
        }
        
        // ==================== –ö–õ–ê–°–°–´ –ò–ì–†–û–í–´–• –û–ë–™–ï–ö–¢–û–í ====================
        
        // –ö–ª–∞—Å—Å –±–∞—à–Ω–∏
        class Tower {
            constructor(x, y, type) {
                this.x = x;
                this.y = y;
                this.type = type;
                this.level = 1;
                this.range = this.getRange();
                this.damage = this.getDamage();
                this.fireRate = this.getFireRate();
                this.cooldown = 0;
                this.color = this.getColor();
                this.upgradeCost = 120;
                this.projectileColor = this.getProjectileColor();
                this.specialAbility = this.getSpecialAbility();
                this.target = null;
                this.rotation = 0;
                this.id = Math.random().toString(36).substr(2, 9);
            }
            
            getRange() {
                const ranges = { basic: 140, sniper: 220, cannon: 110, magic: 160 };
                return ranges[this.type] * (1 + (this.level - 1) * 0.2);
            }
            
            getDamage() {
                const damages = { basic: 15, sniper: 35, cannon: 50, magic: 20 };
                return damages[this.type] * (1 + (this.level - 1) * 0.5);
            }
            
            getFireRate() {
                const rates = { basic: 60, sniper: 120, cannon: 150, magic: 30 };
                return Math.max(10, rates[this.type] * (1 - (this.level - 1) * 0.1));
            }
            
            getColor() {
                const colors = {
                    basic: '#32CD32',
                    sniper: '#1E90FF',
                    cannon: '#FF4500',
                    magic: '#BA55D3'
                };
                return colors[this.type];
            }
            
            getProjectileColor() {
                const colors = {
                    basic: '#00FF00',
                    sniper: '#4169E1',
                    cannon: '#FF8C00',
                    magic: '#FF00FF'
                };
                return colors[this.type];
            }
            
            getSpecialAbility() {
                const abilities = {
                    basic: '–ë—ã—Å—Ç—Ä–∞—è —Å—Ç—Ä–µ–ª—å–±–∞',
                    sniper: '–ü—Ä–æ–±–∏–≤–∞–Ω–∏–µ –±—Ä–æ–Ω–∏',
                    cannon: '–í–∑—Ä—ã–≤–Ω–∞—è –∞—Ç–∞–∫–∞',
                    magic: '–ó–∞–º–µ–¥–ª–µ–Ω–∏–µ –≤—Ä–∞–≥–æ–≤'
                };
                return abilities[this.type];
            }
            
            update() {
                if (this.cooldown > 0) {
                    this.cooldown--;
                    return;
                }
                
                // –ü–æ–∏—Å–∫ —Ü–µ–ª–∏
                this.findTarget();
                
                // –°—Ç—Ä–µ–ª—å–±–∞ –ø–æ —Ü–µ–ª–∏
                if (this.target && this.target.health > 0) {
                    this.shoot();
                    this.cooldown = this.fireRate;
                    
                    // –í–∏–∑—É–∞–ª—å–Ω—ã–π —ç—Ñ—Ñ–µ–∫—Ç –≤—ã—Å—Ç—Ä–µ–ª–∞
                    this.createMuzzleFlash();
                }
            }
            
            findTarget() {
                let closestEnemy = null;
                let minDistance = this.range;
                
                for (const enemy of enemies) {
                    if (enemy.health <= 0) continue;
                    
                    const dx = enemy.x - this.x;
                    const dy = enemy.y - this.y;
                    const distance = Math.sqrt(dx * dx + dy * dy);
                    
                    if (distance < minDistance) {
                        minDistance = distance;
                        closestEnemy = enemy;
                    }
                }
                
                this.target = closestEnemy;
                
                // –ü–æ–≤–æ—Ä–æ—Ç –±–∞—à–Ω–∏ –∫ —Ü–µ–ª–∏
                if (this.target) {
                    const dx = this.target.x - this.x;
                    const dy = this.target.y - this.y;
                    this.rotation = Math.atan2(dy, dx);
                }
            }
            
            shoot() {
                if (!this.target) return;
                
                const projectile = new Projectile(
                    this.x,
                    this.y,
                    this.target,
                    this.damage,
                    this.type,
                    this.projectileColor,
                    this.level
                );
                
                projectiles.push(projectile);
                
                // –°–æ–∑–¥–∞–Ω–∏–µ —ç—Ñ—Ñ–µ–∫—Ç–∞ –≤—ã—Å—Ç—Ä–µ–ª–∞
                for (let i = 0; i < 5; i++) {
                    particles.push(new Particle(
                        this.x,
                        this.y,
                        this.projectileColor,
                        {
                            x: (Math.random() - 0.5) * 4,
                            y: (Math.random() - 0.5) * 4
                        },
                        Math.random() * 2 + 1,
                        30
                    ));
                }
            }
            
            createMuzzleFlash() {
                effects.push({
                    type: 'muzzleFlash',
                    x: this.x + Math.cos(this.rotation) * 25,
                    y: this.y + Math.sin(this.rotation) * 25,
                    rotation: this.rotation,
                    life: 10,
                    size: 15
                });
            }
            
            draw() {
                // –û—Å–Ω–æ–≤–∞–Ω–∏–µ –±–∞—à–Ω–∏
                ctx.save();
                ctx.translate(this.x, this.y);
                ctx.rotate(this.rotation);
                
                // –ö–æ—Ä–ø—É—Å –±–∞—à–Ω–∏
                ctx.fillStyle = this.color;
                ctx.beginPath();
                ctx.arc(0, 0, 20, 0, Math.PI * 2);
                ctx.fill();
                
                // –î–µ—Ç–∞–ª–∏
                ctx.fillStyle = '#222';
                ctx.beginPath();
                ctx.arc(0, 0, 15, 0, Math.PI * 2);
                ctx.fill();
                
                // –°—Ç–≤–æ–ª –±–∞—à–Ω–∏
                ctx.fillStyle = '#444';
                ctx.fillRect(15, -5, 25, 10);
                
                // –£—Ä–æ–≤–µ–Ω—å –±–∞—à–Ω–∏
                ctx.fillStyle = '#FFD700';
                ctx.font = 'bold 14px Arial';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                
                ctx.restore();
                
                // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —É—Ä–æ–≤–Ω—è
                ctx.fillStyle = '#FFD700';
                ctx.font = 'bold 14px Arial';
                ctx.textAlign = 'center';
                ctx.fillText(this.level.toString(), this.x, this.y + 30);
                
                // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ä–∞–¥–∏—É—Å–∞ –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏
                if (gameState.selectedTowerForUpgrade === this) {
                    ctx.strokeStyle = `${this.color}80`;
                    ctx.lineWidth = 2;
                    ctx.beginPath();
                    ctx.arc(this.x, this.y, this.range, 0, Math.PI * 2);
                    ctx.stroke();
                }
            }
            
            upgrade() {
                this.level++;
                this.range = this.getRange();
                this.damage = this.getDamage();
                this.fireRate = this.getFireRate();
                this.upgradeCost = Math.floor(this.upgradeCost * 1.5);
                
                // –í–∏–∑—É–∞–ª—å–Ω—ã–π —ç—Ñ—Ñ–µ–∫—Ç —É–ª—É—á—à–µ–Ω–∏—è
                for (let i = 0; i < 20; i++) {
                    particles.push(new Particle(
                        this.x,
                        this.y,
                        '#FFD700',
                        {
                            x: (Math.random() - 0.5) * 6,
                            y: (Math.random() - 0.5) * 6
                        },
                        Math.random() * 3 + 2,
                        60
                    ));
                }
                
                showMessage(`–ë–∞—à–Ω—è —É–ª—É—á—à–µ–Ω–∞ –¥–æ —É—Ä–æ–≤–Ω—è ${this.level}!`);
                updateUI();
            }
        }
        
        // –ö–ª–∞—Å—Å –≤—Ä–∞–≥–∞
        class Enemy {
            constructor(type, wave) {
                this.type = type;
                this.wave = wave;
                this.pathIndex = 0;
                this.x = enemyPath[0].x;
                this.y = enemyPath[0].y;
                this.speed = this.getSpeed();
                this.health = this.getHealth();
                this.maxHealth = this.health;
                this.reward = this.getReward();
                this.color = this.getColor();
                this.slowDuration = 0;
                this.id = Math.random().toString(36).substr(2, 9);
                this.isBoss = wave % 5 === 0;
                
                if (this.isBoss) {
                    this.health *= 3;
                    this.maxHealth = this.health;
                    this.reward *= 5;
                    this.speed *= 0.7;
                }
            }
            
            getSpeed() {
                const speeds = { basic: 1.2, fast: 2.0, tank: 0.8 };
                const speed = speeds[this.type] || 1.0;
                return speed * (1 + (this.wave - 1) * 0.05);
            }
            
            getHealth() {
                const healths = { basic: 40, fast: 25, tank: 120 };
                const health = healths[this.type] || 40;
                return Math.floor(health * (1 + (this.wave - 1) * 0.2));
            }
            
            getReward() {
                const rewards = { basic: 15, fast: 20, tank: 40 };
                return rewards[this.type] || 15;
            }
            
            getColor() {
                const colors = {
                    basic: '#FF6347',
                    fast: '#00CED1',
                    tank: '#696969'
                };
                return colors[this.type] || '#FF6347';
            }
            
            update() {
                // –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –∑–∞–º–µ–¥–ª–µ–Ω–∏—è
                let effectiveSpeed = this.speed;
                if (this.slowDuration > 0) {
                    effectiveSpeed *= 0.5;
                    this.slowDuration--;
                }
                
                // –î–≤–∏–∂–µ–Ω–∏–µ –ø–æ –ø—É—Ç–∏
                if (this.pathIndex >= enemyPath.length - 1) {
                    // –í—Ä–∞–≥ –¥–æ—Å—Ç–∏–≥ –∑–∞–º–∫–∞
                    gameState.lives--;
                    if (gameState.lives <= 0) {
                        gameOver();
                    }
                    return false;
                }
                
                const target = enemyPath[this.pathIndex + 1];
                const dx = target.x - this.x;
                const dy = target.y - this.y;
                const distance = Math.sqrt(dx * dx + dy * dy);
                
                if (distance < effectiveSpeed) {
                    this.pathIndex++;
                } else {
                    this.x += (dx / distance) * effectiveSpeed;
                    this.y += (dy / distance) * effectiveSpeed;
                }
                
                return this.health > 0;
            }
            
            draw() {
                // –¢–µ–ª–æ –≤—Ä–∞–≥–∞
                ctx.fillStyle = this.color;
                ctx.beginPath();
                
                if (this.isBoss) {
                    // –ë–æ—Å—Å –±–æ–ª—å—à–µ –æ–±—ã—á–Ω—ã—Ö –≤—Ä–∞–≥–æ–≤
                    ctx.arc(this.x, this.y, 18, 0, Math.PI * 2);
                    
                    // –ö–æ—Ä–æ–Ω–∞ –¥–ª—è –±–æ—Å—Å–∞
                    ctx.save();
                    ctx.fillStyle = '#FFD700';
                    ctx.beginPath();
                    ctx.moveTo(this.x - 15, this.y - 15);
                    ctx.lineTo(this.x - 5, this.y - 25);
                    ctx.lineTo(this.x + 5, this.y - 15);
                    ctx.lineTo(this.x + 15, this.y - 25);
                    ctx.lineTo(this.x + 25, this.y - 15);
                    ctx.lineTo(this.x + 15, this.y - 5);
                    ctx.lineTo(this.x - 15, this.y - 15);
                    ctx.fill();
                    ctx.restore();
                } else {
                    ctx.arc(this.x, this.y, 12, 0, Math.PI * 2);
                }
                
                ctx.fill();
                
                // –î–µ—Ç–∞–ª–∏ –≤—Ä–∞–≥–∞
                ctx.fillStyle = '#000';
                ctx.beginPath();
                ctx.arc(this.x - 4, this.y - 4, 3, 0, Math.PI * 2);
                ctx.fill();
                
                // –ü–æ–ª–æ—Å–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è
                const healthWidth = this.isBoss ? 40 : 30;
                const healthPercent = this.health / this.maxHealth;
                
                ctx.fillStyle = '#FF0000';
                ctx.fillRect(this.x - healthWidth/2, this.y - 25, healthWidth, 5);
                
                ctx.fillStyle = healthPercent > 0.5 ? '#00FF00' : '#FFA500';
                ctx.fillRect(this.x - healthWidth/2, this.y - 25, healthWidth * healthPercent, 5);
                
                // –¢–∏–ø –≤—Ä–∞–≥–∞ (–∏–∫–æ–Ω–∫–∞)
                ctx.fillStyle = '#FFF';
                ctx.font = 'bold 12px Arial';
                ctx.textAlign = 'center';
                
                const icon = this.type === 'basic' ? 'üë§' : 
                            this.type === 'fast' ? '‚ö°' : 'üõ°Ô∏è';
                
                ctx.fillText(icon, this.x, this.y + 5);
                
                // –≠—Ñ—Ñ–µ–∫—Ç –∑–∞–º–µ–¥–ª–µ–Ω–∏—è
                if (this.slowDuration > 0) {
                    ctx.strokeStyle = '#00BFFF';
                    ctx.lineWidth = 2;
                    ctx.beginPath();
                    ctx.arc(this.x, this.y, 15, 0, Math.PI * 2);
                    ctx.stroke();
                }
            }
            
            takeDamage(damage, effect = null) {
                this.health -= damage;
                
                // –≠—Ñ—Ñ–µ–∫—Ç –ø–æ–ø–∞–¥–∞–Ω–∏—è
                for (let i = 0; i < 5; i++) {
                    particles.push(new Particle(
                        this.x,
                        this.y,
                        this.color,
                        {
                            x: (Math.random() - 0.5) * 4,
                            y: (Math.random() - 0.5) * 4
                        },
                        Math.random() * 2 + 1,
                        20
                    ));
                }
                
                if (effect === 'slow') {
                    this.slowDuration = 60; // 2 —Å–µ–∫—É–Ω–¥—ã –ø—Ä–∏ 60 FPS
                }
                
                if (this.health <= 0) {
                    this.onDeath();
                    return false;
                }
                return true;
            }
            
            onDeath() {
                gameState.gold += this.reward;
                gameState.score += this.reward * 10;
                gameState.enemiesKilled++;
                gameState.enemiesAlive--;
                
                // –≠—Ñ—Ñ–µ–∫—Ç —Å–º–µ—Ä—Ç–∏
                for (let i = 0; i < 15; i++) {
                    particles.push(new Particle(
                        this.x,
                        this.y,
                        this.color,
                        {
                            x: (Math.random() - 0.5) * 8,
                            y: (Math.random() - 0.5) * 8
                        },
                        Math.random() * 3 + 2,
                        40
                    ));
                }
                
                // –û—Å–æ–±—ã–π —ç—Ñ—Ñ–µ–∫—Ç –¥–ª—è –±–æ—Å—Å–∞
                if (this.isBoss) {
                    showMessage(`–ë–û–°–° –£–ù–ò–ß–¢–û–ñ–ï–ù! +${this.reward} –∑–æ–ª–æ—Ç–∞`);
                    for (let i = 0; i < 30; i++) {
                        particles.push(new Particle(
                            this.x,
                            this.y,
                            '#FFD700',
                            {
                                x: (Math.random() - 0.5) * 10,
                                y: (Math.random() - 0.5) * 10
                            },
                            Math.random() * 4 + 3,
                            60
                        ));
                    }
                }
            }
        }
        
        // –ö–ª–∞—Å—Å —Å–Ω–∞—Ä—è–¥–∞
        class Projectile {
            constructor(x, y, target, damage, type, color, level) {
                this.x = x;
                this.y = y;
                this.target = target;
                this.damage = damage;
                this.type = type;
                this.color = color;
                this.level = level;
                this.speed = 7;
                this.size = 6 + level;
                this.trail = [];
                this.maxTrailLength = 5;
            }
            
            update() {
                if (!this.target || this.target.health <= 0) {
                    return false;
                }
                
                // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–∏ –¥–ª—è —Å–ª–µ–¥–∞
                this.trail.push({x: this.x, y: this.y});
                if (this.trail.length > this.maxTrailLength) {
                    this.trail.shift();
                }
                
                // –î–≤–∏–∂–µ–Ω–∏–µ –∫ —Ü–µ–ª–∏
                const dx = this.target.x - this.x;
                const dy = this.target.y - this.y;
                const distance = Math.sqrt(dx * dx + dy * dy);
                
                if (distance < this.speed) {
                    // –ü–æ–ø–∞–¥–∞–Ω–∏–µ
                    this.onHit();
                    return false;
                } else {
                    this.x += (dx / distance) * this.speed;
                    this.y += (dy / distance) * this.speed;
                    return true;
                }
            }
            
            onHit() {
                let effect = null;
                
                // –û—Å–æ–±—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞ —Å–Ω–∞—Ä—è–¥–∞
                switch(this.type) {
                    case 'cannon':
                        // –í–∑—Ä—ã–≤–Ω–∞—è –∞—Ç–∞–∫–∞
                        for (let enemy of enemies) {
                            const dx = enemy.x - this.target.x;
                            const dy = enemy.y - this.target.y;
                            const distance = Math.sqrt(dx * dx + dy * dy);
                            
                            if (distance < 50 && enemy.health > 0) {
                                enemy.takeDamage(this.damage * 0.5);
                            }
                        }
                        effect = 'explosion';
                        break;
                        
                    case 'magic':
                        effect = 'slow';
                        break;
                        
                    default:
                        effect = 'normal';
                }
                
                this.target.takeDamage(this.damage, effect);
                
                // –í–∏–∑—É–∞–ª—å–Ω—ã–π —ç—Ñ—Ñ–µ–∫—Ç –ø–æ–ø–∞–¥–∞–Ω–∏—è
                if (effect === 'explosion') {
                    for (let i = 0; i < 20; i++) {
                        particles.push(new Particle(
                            this.target.x,
                            this.target.y,
                            '#FF8C00',
                            {
                                x: (Math.random() - 0.5) * 8,
                                y: (Math.random() - 0.5) * 8
                            },
                            Math.random() * 4 + 2,
                            40
                        ));
                    }
                }
            }
            
            draw() {
                // –°–ª–µ–¥ —Å–Ω–∞—Ä—è–¥–∞
                for (let i = 0; i < this.trail.length; i++) {
                    const point = this.trail[i];
                    const alpha = i / this.trail.length;
                    
                    ctx.save();
                    ctx.globalAlpha = alpha * 0.5;
                    ctx.fillStyle = this.color;
                    ctx.beginPath();
                    ctx.arc(point.x, point.y, this.size * alpha, 0, Math.PI * 2);
                    ctx.fill();
                    ctx.restore();
                }
                
                // –°–Ω–∞—Ä—è–¥
                ctx.fillStyle = this.color;
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                ctx.fill();
                
                // –°–≤–µ—á–µ–Ω–∏–µ
                ctx.shadowColor = this.color;
                ctx.shadowBlur = 15;
                ctx.fill();
                ctx.shadowBlur = 0;
            }
        }
        
        // ==================== –ò–ì–†–û–í–ê–Ø –õ–û–ì–ò–ö–ê ====================
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
        function updateUI() {
            document.getElementById('goldAmount').textContent = gameState.gold;
            document.getElementById('livesCount').textContent = gameState.lives;
            document.getElementById('waveNumber').textContent = `${gameState.wave}/${gameState.totalWaves}`;
            document.getElementById('enemiesKilled').textContent = gameState.enemiesKilled;
            document.getElementById('scoreValue').textContent = gameState.score;
            
            document.getElementById('selectedTowerName').textContent = 
                gameState.selectedTower === 'basic' ? '–°—Ç—Ä–µ–ª–∫–æ–≤–∞—è' :
                gameState.selectedTower === 'sniper' ? '–°–Ω–∞–π–ø–µ—Ä—Å–∫–∞—è' :
                gameState.selectedTower === 'cannon' ? '–ü—É—à–∫–∞' : '–ú–∞–≥–∏—á–µ—Å–∫–∞—è';
            
            document.getElementById('towerLevel').textContent = gameState.towerLevel;
            document.getElementById('upgradeCost').textContent = gameState.upgradeCost;
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –≤–æ–ª–Ω—ã
            const progress = gameState.enemiesAlive / gameState.enemiesInWave;
            const progressPercent = Math.max(0, (1 - progress) * 100);
            document.getElementById('waveProgressBar').style.width = `${progressPercent}%`;
            document.getElementById('waveProgressText').textContent = 
                `${gameState.enemiesInWave - gameState.enemiesAlive}/${gameState.enemiesInWave}`;
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ
        function showMessage(text) {
            const messageElement = document.getElementById('gameMessage');
            messageElement.textContent = text;
            
            // –ê–Ω–∏–º–∞—Ü–∏—è —Å–æ–æ–±—â–µ–Ω–∏—è
            messageElement.style.animation = 'none';
            setTimeout(() => {
                messageElement.style.animation = 'pulse 2s infinite';
            }, 10);
        }
        
        // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –∏–≥—Ä–æ–≤–æ–≥–æ –ø–æ–ª—è
        function drawGameField() {
            // –§–æ–Ω
            const gradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
            gradient.addColorStop(0, '#0a0a1a');
            gradient.addColorStop(1, '#1a1a2e');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // –ü—É—Ç—å –≤—Ä–∞–≥–æ–≤
            ctx.strokeStyle = '#8B4513';
            ctx.lineWidth = 35;
            ctx.lineCap = 'round';
            ctx.lineJoin = 'round';
            ctx.beginPath();
            ctx.moveTo(enemyPath[0].x, enemyPath[0].y);
            
            for (let i = 1; i < enemyPath.length; i++) {
                ctx.lineTo(enemyPath[i].x, enemyPath[i].y);
            }
            ctx.stroke();
            
            // –û–∫–∞–Ω—Ç–æ–≤–∫–∞ –ø—É—Ç–∏
            ctx.strokeStyle = '#DAA520';
            ctx.lineWidth = 5;
            ctx.setLineDash([10, 5]);
            ctx.beginPath();
            ctx.moveTo(enemyPath[0].x, enemyPath[0].y);
            
            for (let i = 1; i < enemyPath.length; i++) {
                ctx.lineTo(enemyPath[i].x, enemyPath[i].y);
            }
            ctx.stroke();
            ctx.setLineDash([]);
            
            // –¢–æ—á–∫–∏ –ø—É—Ç–∏
            ctx.fillStyle = '#FFD700';
            for (const point of enemyPath) {
                ctx.beginPath();
                ctx.arc(point.x, point.y, 8, 0, Math.PI * 2);
                ctx.fill();
                
                ctx.strokeStyle = '#8B4513';
                ctx.lineWidth = 2;
                ctx.stroke();
            }
            
            // –ó–∞–º–æ–∫ –≤ –∫–æ–Ω—Ü–µ –ø—É—Ç–∏
            drawCastle();
        }
        
        // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –∑–∞–º–∫–∞
        function drawCastle() {
            const castleX = canvas.width - 60;
            const castleY = enemyPath[enemyPath.length - 1].y - 40;
            
            // –û—Å–Ω–æ–≤–∞–Ω–∏–µ –∑–∞–º–∫–∞
            ctx.fillStyle = '#2F4F4F';
            ctx.fillRect(castleX, castleY, 60, 80);
            
            // –ë–∞—à–Ω–∏ –∑–∞–º–∫–∞
            ctx.fillStyle = '#696969';
            ctx.fillRect(castleX - 10, castleY - 20, 20, 20);
            ctx.fillRect(castleX + 50, castleY - 20, 20, 20);
            
            // –ö—Ä—ã—à–∏
            ctx.fillStyle = '#8B0000';
            ctx.beginPath();
            ctx.moveTo(castleX - 15, castleY - 20);
            ctx.lineTo(castleX + 5, castleY - 40);
            ctx.lineTo(castleX + 25, castleY - 20);
            ctx.closePath();
            ctx.fill();
            
            ctx.beginPath();
            ctx.moveTo(castleX + 45, castleY - 20);
            ctx.lineTo(castleX + 65, castleY - 40);
            ctx.lineTo(castleX + 85, castleY - 20);
            ctx.closePath();
            ctx.fill();
            
            // –í–æ—Ä–æ—Ç–∞
            ctx.fillStyle = '#8B4513';
            ctx.fillRect(castleX + 20, castleY + 20, 20, 40);
            
            // –§–ª–∞–≥
            ctx.fillStyle = '#FF0000';
            ctx.beginPath();
            ctx.moveTo(castleX + 30, castleY - 40);
            ctx.lineTo(castleX + 30, castleY - 60);
            ctx.lineTo(castleX + 40, castleY - 55);
            ctx.closePath();
            ctx.fill();
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏ –æ—Ç—Ä–∏—Å–æ–≤–∫–∞ —ç—Ñ—Ñ–µ–∫—Ç–æ–≤
        function updateAndDrawEffects() {
            for (let i = effects.length - 1; i >= 0; i--) {
                const effect = effects[i];
                
                switch(effect.type) {
                    case 'muzzleFlash':
                        ctx.save();
                        ctx.translate(effect.x, effect.y);
                        ctx.rotate(effect.rotation);
                        
                        ctx.fillStyle = `rgba(255, 255, 200, ${effect.life / 10})`;
                        ctx.beginPath();
                        ctx.arc(0, 0, effect.size, 0, Math.PI * 2);
                        ctx.fill();
                        
                        ctx.restore();
                        break;
                }
                
                effect.life--;
                if (effect.life <= 0) {
                    effects.splice(i, 1);
                }
            }
        }
        
        // –û—Å–Ω–æ–≤–Ω–æ–π –∏–≥—Ä–æ–≤–æ–π —Ü–∏–∫–ª
        function gameLoop() {
            if (gameState.gamePaused || !gameState.gameRunning) return;
            
            // –û—á–∏—Å—Ç–∫–∞ —Ö–æ–ª—Å—Ç–∞
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –∏–≥—Ä–æ–≤–æ–≥–æ –ø–æ–ª—è
            drawGameField();
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏ –æ—Ç—Ä–∏—Å–æ–≤–∫–∞ —á–∞—Å—Ç–∏—Ü
            for (let i = particles.length - 1; i >= 0; i--) {
                if (!particles[i].update()) {
                    particles.splice(i, 1);
                } else {
                    particles[i].draw();
                }
            }
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏ –æ—Ç—Ä–∏—Å–æ–≤–∫–∞ –±–∞—à–µ–Ω
            for (const tower of towers) {
                tower.update();
                tower.draw();
            }
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏ –æ—Ç—Ä–∏—Å–æ–≤–∫–∞ –≤—Ä–∞–≥–æ–≤
            for (let i = enemies.length - 1; i >= 0; i--) {
                if (!enemies[i].update()) {
                    enemies.splice(i, 1);
                } else {
                    enemies[i].draw();
                }
            }
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏ –æ—Ç—Ä–∏—Å–æ–≤–∫–∞ —Å–Ω–∞—Ä—è–¥–æ–≤
            for (let i = projectiles.length - 1; i >= 0; i--) {
                if (!projectiles[i].update()) {
                    projectiles.splice(i, 1);
                } else {
                    projectiles[i].draw();
                }
            }
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏ –æ—Ç—Ä–∏—Å–æ–≤–∫–∞ —ç—Ñ—Ñ–µ–∫—Ç–æ–≤
            updateAndDrawEffects();
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –≤–æ–ª–Ω—ã
            if (enemies.length === 0 && gameState.enemiesAlive === 0 && gameState.gameRunning) {
                if (gameState.wave > gameState.totalWaves) {
                    victory();
                } else {
                    showMessage(`–í–æ–ª–Ω–∞ ${gameState.wave - 1} –∑–∞–≤–µ—Ä—à–µ–Ω–∞! –ü–æ–¥–≥–æ—Ç–æ–≤—å—Ç–µ—Å—å –∫ –≤–æ–ª–Ω–µ ${gameState.wave}`);
                    gameState.gameRunning = false;
                    document.getElementById('startWaveBtn').innerHTML = '<i class="fas fa-play"></i> –ù–ê–ß–ê–¢–¨ –í–û–õ–ù–£';
                }
            }
            
            updateUI();
        }
        
        // –ó–∞–ø—É—Å–∫ –Ω–æ–≤–æ–π –≤–æ–ª–Ω—ã
        function startWave() {
            if (gameState.gameRunning) return;
            
            gameState.gameRunning = true;
            gameState.enemiesAlive = gameState.enemiesInWave;
            
            // –°–æ–∑–¥–∞–Ω–∏–µ –≤—Ä–∞–≥–æ–≤ –¥–ª—è –≤–æ–ª–Ω—ã
            const enemyTypes = ['basic', 'fast', 'tank'];
            
            for (let i = 0; i < gameState.enemiesInWave; i++) {
                // –í—ã–±–æ—Ä —Ç–∏–ø–∞ –≤—Ä–∞–≥–∞ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –≤–æ–ª–Ω—ã
                let typeIndex = 0;
                if (gameState.wave > 3) typeIndex = Math.floor(Math.random() * 2);
                if (gameState.wave > 6) typeIndex = Math.floor(Math.random() * 3);
                
                setTimeout(() => {
                    enemies.push(new Enemy(enemyTypes[typeIndex], gameState.wave));
                }, i * 1000);
            }
            
            showMessage(`–í–æ–ª–Ω–∞ ${gameState.wave} –Ω–∞—á–∞–ª–∞—Å—å! –£–Ω–∏—á—Ç–æ–∂—å—Ç–µ ${gameState.enemiesInWave} –≤—Ä–∞–≥–æ–≤!`);
            
            // –£–≤–µ–ª–∏—á–µ–Ω–∏–µ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–π –≤–æ–ª–Ω—ã
            gameState.wave++;
            gameState.enemiesInWave = Math.floor(6 + (gameState.wave - 1) * 1.2);
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–Ω–æ–ø–∫–∏
            document.getElementById('startWaveBtn').innerHTML = '<i class="fas fa-sync-alt"></i> –í–û–õ–ù–ê –ò–î–Å–¢...';
        }
        
        // –ö–æ–Ω–µ—Ü –∏–≥—Ä—ã
        function gameOver() {
            gameState.gameRunning = false;
            showMessage(`–ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞! –í—ã –¥–æ—à–ª–∏ –¥–æ –≤–æ–ª–Ω—ã ${gameState.wave - 1}. –°—á—ë—Ç: ${gameState.score}`);
            
            // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
            saveScore(gameState.score, gameState.wave - 1);
            
            alert(`–ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞! –í—ã –¥–æ—à–ª–∏ –¥–æ –≤–æ–ª–Ω—ã ${gameState.wave - 1}. –í–∞—à —Å—á—ë—Ç: ${gameState.score}`);
            resetGame();
        }
        
        // –ü–æ–±–µ–¥–∞
        function victory() {
            gameState.gameRunning = false;
            showMessage(`–ü–û–ë–ï–î–ê! –í—ã –∑–∞—â–∏—Ç–∏–ª–∏ –∫–æ—Ä–æ–ª–µ–≤—Å—Ç–≤–æ! –§–∏–Ω–∞–ª—å–Ω—ã–π —Å—á—ë—Ç: ${gameState.score}`);
            
            // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
            saveScore(gameState.score, gameState.wave - 1);
            
            alert(`–ü–û–ë–ï–î–ê! –í—ã –∑–∞—â–∏—Ç–∏–ª–∏ –∫–æ—Ä–æ–ª–µ–≤—Å—Ç–≤–æ! –§–∏–Ω–∞–ª—å–Ω—ã–π —Å—á—ë—Ç: ${gameState.score}`);
            resetGame();
        }
        
        // –°–±—Ä–æ—Å –∏–≥—Ä—ã
        function resetGame() {
            gameState = {
                gold: 200,
                lives: 25,
                score: 0,
                wave: 1,
                totalWaves: 15,
                enemiesKilled: 0,
                enemiesInWave: 6,
                enemiesAlive: 0,
                gameRunning: false,
                gamePaused: false,
                selectedTower: 'basic',
                selectedTowerCost: 60,
                towerLevel: 1,
                upgradeCost: 120,
                selectedTowerForUpgrade: null,
                waveStartTime: 0,
                waveDuration: 60000
            };
            
            towers.length = 0;
            enemies.length = 0;
            projectiles.length = 0;
            particles.length = 0;
            effects.length = 0;
            
            updateUI();
            showMessage("–ò–≥—Ä–∞ —Å–±—Ä–æ—à–µ–Ω–∞. –í—ã–±–µ—Ä–∏—Ç–µ –±–∞—à–Ω—é –∏ –Ω–∞—á–Ω–∏—Ç–µ –∏–≥—Ä—É!");
        }
        
        // ==================== –û–ë–†–ê–ë–û–¢–ß–ò–ö–ò –°–û–ë–´–¢–ò–ô ====================
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–ª–∏–∫–æ–≤ –ø–æ —Ö–æ–ª—Å—Ç—É
        canvas.addEventListener('click', (e) => {
            if (!gameState.gameRunning) {
                showMessage("–°–Ω–∞—á–∞–ª–∞ –∑–∞–ø—É—Å—Ç–∏—Ç–µ –≤–æ–ª–Ω—É!");
                return;
            }
            
            const rect = canvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–ª–∏–∫–∞ –ø–æ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –±–∞—à–Ω–µ
            for (const tower of towers) {
                const dx = tower.x - x;
                const dy = tower.y - y;
                const distance = Math.sqrt(dx * dx + dy * dy);
                
                if (distance < 25) {
                    gameState.selectedTowerForUpgrade = tower;
                    gameState.upgradeCost = tower.upgradeCost;
                    showMessage(`–í—ã–±—Ä–∞–Ω–∞ –±–∞—à–Ω—è —É—Ä–æ–≤–Ω—è ${tower.level}. –£–ª—É—á—à–µ–Ω–∏–µ: ${tower.upgradeCost} –∑–æ–ª–æ—Ç–∞`);
                    updateUI();
                    return;
                }
            }
            
            // –°–±—Ä–æ—Å –≤—ã–±–æ—Ä–∞ –±–∞—à–Ω–∏
            gameState.selectedTowerForUpgrade = null;
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ—Å—Ç–∏ –∑–æ–ª–æ—Ç–∞
            if (gameState.gold < gameState.selectedTowerCost) {
                showMessage(`–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∑–æ–ª–æ—Ç–∞! –ù—É–∂–Ω–æ ${gameState.selectedTowerCost}, —É –≤–∞—Å ${gameState.gold}`);
                return;
            }
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑–º–µ—â–µ–Ω–∏—è –Ω–∞ –ø—É—Ç–∏
            if (isPointOnPath(x, y, 40)) {
                showMessage("–ù–µ–ª—å–∑—è —Å—Ç–∞–≤–∏—Ç—å –±–∞—à–Ω–∏ –Ω–∞ –ø—É—Ç–∏ –≤—Ä–∞–≥–æ–≤!");
                return;
            }
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è –¥–æ –¥—Ä—É–≥–∏—Ö –±–∞—à–µ–Ω
            for (const tower of towers) {
                const dx = tower.x - x;
                const dy = tower.y - y;
                const distance = Math.sqrt(dx * dx + dy * dy);
                
                if (distance < 60) {
                    showMessage("–ë–∞—à–Ω–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –Ω–∞ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–∏ –Ω–µ –º–µ–Ω–µ–µ 60px –¥—Ä—É–≥ –æ—Ç –¥—Ä—É–≥–∞!");
                    return;
                }
            }
            
            // –°–æ–∑–¥–∞–Ω–∏–µ –±–∞—à–Ω–∏
            towers.push(new Tower(x, y, gameState.selectedTower));
            gameState.gold -= gameState.selectedTowerCost;
            showMessage(`–ë–∞—à–Ω—è –ø–æ—Å—Ç—Ä–æ–µ–Ω–∞! –û—Å—Ç–∞–ª–æ—Å—å –∑–æ–ª–æ—Ç–∞: ${gameState.gold}`);
            
            // –í–∏–∑—É–∞–ª—å–Ω—ã–π —ç—Ñ—Ñ–µ–∫—Ç –ø–æ—Å—Ç—Ä–æ–π–∫–∏
            for (let i = 0; i < 15; i++) {
                particles.push(new Particle(
                    x, y,
                    '#32CD32',
                    {
                        x: (Math.random() - 0.5) * 6,
                        y: (Math.random() - 0.5) * 6
                    },
                    Math.random() * 3 + 2,
                    40
                ));
            }
            
            updateUI();
        });
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ—á–∫–∏ –Ω–∞ –ø—É—Ç–∏
        function isPointOnPath(px, py, threshold) {
            for (let i = 0; i < enemyPath.length - 1; i++) {
                const A = enemyPath[i];
                const B = enemyPath[i + 1];
                
                const distance = pointToLineDistance(px, py, A.x, A.y, B.x, B.y);
                if (distance < threshold) {
                    return true;
                }
            }
            return false;
        }
        
        // –†–∞—Å—Å—Ç–æ—è–Ω–∏–µ –æ—Ç —Ç–æ—á–∫–∏ –¥–æ –æ—Ç—Ä–µ–∑–∫–∞
        function pointToLineDistance(px, py, x1, y1, x2, y2) {
            const A = px - x1;
            const B = py - y1;
            const C = x2 - x1;
            const D = y2 - y1;
            
            const dot = A * C + B * D;
            const lenSq = C * C + D * D;
            let param = -1;
            
            if (lenSq !== 0) param = dot / lenSq;
            
            let xx, yy;
            
            if (param < 0) {
                xx = x1;
                yy = y1;
            } else if (param > 1) {
                xx = x2;
                yy = y2;
            } else {
                xx = x1 + param * C;
                yy = y1 + param * D;
            }
            
            const dx = px - xx;
            const dy = py - yy;
            
            return Math.sqrt(dx * dx + dy * dy);
        }
        
        // –ù–∞–≤–µ–¥–µ–Ω–∏–µ –Ω–∞ –±–∞—à–Ω—é
        canvas.addEventListener('mousemove', (e) => {
            const rect = canvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            
            // –°–±—Ä–æ—Å –ø–æ–¥—Å–≤–µ—Ç–∫–∏ –µ—Å–ª–∏ –Ω–µ –Ω–∞–≤–µ–¥–µ–Ω–æ –Ω–∞ –±–∞—à–Ω—é
            let hovered = false;
            
            for (const tower of towers) {
                const dx = tower.x - x;
                const dy = tower.y - y;
                const distance = Math.sqrt(dx * dx + dy * dy);
                
                if (distance < 25) {
                    hovered = true;
                    canvas.style.cursor = 'pointer';
                    break;
                }
            }
            
            if (!hovered) {
                canvas.style.cursor = 'default';
            }
        });
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–Ω–æ–ø–æ–∫
        document.getElementById('startWaveBtn').addEventListener('click', () => {
            if (gameState.gamePaused) {
                gameState.gamePaused = false;
                showMessage("–ò–≥—Ä–∞ –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∞!");
                document.getElementById('startWaveBtn').innerHTML = '<i class="fas fa-play"></i> –ù–ê–ß–ê–¢–¨ –í–û–õ–ù–£';
            } else if (!gameState.gameRunning) {
                startWave();
            }
        });
        
        document.getElementById('pauseGameBtn').addEventListener('click', () => {
            if (gameState.gameRunning) {
                gameState.gamePaused = !gameState.gamePaused;
                if (gameState.gamePaused) {
                    showMessage("–ò–≥—Ä–∞ –Ω–∞ –ø–∞—É–∑–µ");
                    document.getElementById('pauseGameBtn').innerHTML = '<i class="fas fa-play"></i> –ü–†–û–î–û–õ–ñ–ò–¢–¨';
                } else {
                    showMessage("–ò–≥—Ä–∞ –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∞!");
                    document.getElementById('pauseGameBtn').innerHTML = '<i class="fas fa-pause"></i> –ü–ê–£–ó–ê';
                }
            } else {
                showMessage("–°–Ω–∞—á–∞–ª–∞ –∑–∞–ø—É—Å—Ç–∏—Ç–µ –≤–æ–ª–Ω—É!");
            }
        });
        
        document.getElementById('upgradeTowerBtn').addEventListener('click', () => {
            if (!gameState.selectedTowerForUpgrade) {
                showMessage("–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ –±–∞—à–Ω—é, –∫–ª–∏–∫–Ω—É–≤ –ø–æ –Ω–µ–π!");
                return;
            }
            
            if (gameState.gold < gameState.upgradeCost) {
                showMessage(`–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∑–æ–ª–æ—Ç–∞ –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è! –ù—É–∂–Ω–æ ${gameState.upgradeCost}, —É –≤–∞—Å ${gameState.gold}`);
                return;
            }
            
            gameState.selectedTowerForUpgrade.upgrade();
            gameState.gold -= gameState.upgradeCost;
            gameState.towerLevel = gameState.selectedTowerForUpgrade.level;
            updateUI();
        });
        
        // –í—ã–±–æ—Ä –±–∞—à–µ–Ω
        document.querySelectorAll('.tower-card').forEach(card => {
            card.addEventListener('click', () => {
                document.querySelectorAll('.tower-card').forEach(c => {
                    c.classList.remove('active');
                });
                
                card.classList.add('active');
                gameState.selectedTower = card.dataset.tower;
                gameState.selectedTowerCost = parseInt(card.dataset.cost);
                
                const towerName = card.querySelector('.tower-name').textContent.trim();
                showMessage(`–í—ã–±—Ä–∞–Ω–∞ ${towerName}`);
                updateUI();
            });
        });
        
        // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–æ–¥–∞–ª—å–Ω—ã–º–∏ –æ–∫–Ω–∞–º–∏
        function showModal(modalId) {
            document.getElementById(modalId).style.display = 'flex';
        }
        
        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }
        
        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
        function saveScore(score, wave) {
            const records = JSON.parse(localStorage.getItem('tdRecords') || '[]');
            const record = {
                score: score,
                wave: wave,
                date: new Date().toLocaleDateString(),
                time: new Date().toLocaleTimeString()
            };
            
            records.push(record);
            records.sort((a, b) => b.score - a.score);
            
            if (records.length > 10) records.length = 10;
            
            localStorage.setItem('tdRecords', JSON.stringify(records));
            updateRecordsDisplay();
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã —Ä–µ–∫–æ—Ä–¥–æ–≤
        function updateRecordsDisplay() {
            const records = JSON.parse(localStorage.getItem('tdRecords') || '[]');
            const recordsList = document.getElementById('recordsList');
            
            if (records.length === 0) {
                recordsList.innerHTML = '<p style="text-align: center; color: #aaa;">–†–µ–∫–æ—Ä–¥–æ–≤ –ø–æ–∫–∞ –Ω–µ—Ç</p>';
                return;
            }
            
            let html = '<div style="overflow-x: auto;">';
            html += '<table style="width: 100%; border-collapse: collapse;">';
            html += '<thead><tr style="background: rgba(255, 215, 0, 0.1);">';
            html += '<th style="padding: 10px; text-align: left; color: #ffd700;">#</th>';
            html += '<th style="padding: 10px; text-align: left; color: #ffd700;">–°—á—ë—Ç</th>';
            html += '<th style="padding: 10px; text-align: left; color: #ffd700;">–í–æ–ª–Ω–∞</th>';
            html += '<th style="padding: 10px; text-align: left; color: #ffd700;">–î–∞—Ç–∞</th>';
            html += '</tr></thead><tbody>';
            
            records.forEach((record, index) => {
                const medal = index === 0 ? 'ü•á' : index === 1 ? 'ü•à' : index === 2 ? 'ü•â' : 'üèÖ';
                html += `<tr style="border-bottom: 1px solid rgba(255, 215, 0, 0.2);">`;
                html += `<td style="padding: 10px;">${medal}</td>`;
                html += `<td style="padding: 10px; font-weight: bold; color: #fff;">${record.score}</td>`;
                html += `<td style="padding: 10px;">${record.wave}</td>`;
                html += `<td style="padding: 10px; color: #aaa;">${record.date} ${record.time}</td>`;
                html += `</tr>`;
            });
            
            html += '</tbody></table></div>';
            recordsList.innerHTML = html;
        }
        
        // ==================== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ====================
        
        // –ó–∞–ø—É—Å–∫ –∏–≥—Ä–æ–≤–æ–≥–æ —Ü–∏–∫–ª–∞
        const gameInterval = setInterval(gameLoop, 1000 / 60);
        
        // –°–æ–∑–¥–∞–Ω–∏–µ —Ñ–æ–Ω–æ–≤—ã—Ö —á–∞—Å—Ç–∏—Ü
        createBackgroundParticles();
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ —Ä–µ–∫–æ—Ä–¥–æ–≤
        updateRecordsDisplay();
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è UI
        updateUI();
        showMessage("–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ Tower Defense! –í—ã–±–µ—Ä–∏—Ç–µ –±–∞—à–Ω—é –∏ –Ω–∞—á–Ω–∏—Ç–µ –∏–≥—Ä—É.");
        
        // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –∏—Ö
        window.addEventListener('click', (e) => {
            if (e.target.classList.contains('modal')) {
                e.target.style.display = 'none';
            }
        });
        
        // –ì–æ—Ä—è—á–∏–µ –∫–ª–∞–≤–∏—à–∏
        document.addEventListener('keydown', (e) => {
            switch(e.key) {
                case ' ':
                    document.getElementById('pauseGameBtn').click();
                    break;
                case 'Enter':
                    if (!gameState.gameRunning) {
                        document.getElementById('startWaveBtn').click();
                    }
                    break;
                case '1':
                case '2':
                case '3':
                case '4':
                    const index = parseInt(e.key) - 1;
                    const cards = document.querySelectorAll('.tower-card');
                    if (cards[index]) cards[index].click();
                    break;
                case 'Escape':
                    closeModal('helpModal');
                    closeModal('recordsModal');
                    break;
            }
        });
    </script>
</body>
</html>
